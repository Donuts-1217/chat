<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ”¥ æ ¡åœ’èŠå¤©å®¤ï¼šç™»å…¥</title>

<!-- Tailwind CSS for modern styling -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{
    --bg:#0f1724; --panel:#111827; --muted:#9ca3af; --accent:#5865f2; --accent-2:#2ecc71; --danger:#ef4444;
    --card:#0b1020;
  }
  *{box-sizing:border-box;font-family:'Inter', 'Noto Sans TC', system-ui, -apple-system, sans-serif;}
  body{
    margin:0;
    background:linear-gradient(180deg,#071025 0%, #071223 100%);
    color:#e6eef8;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .login-card{
    background:var(--panel);
    padding:40px;
    border-radius:12px;
    max-width:400px;
    width:90%;
    text-align:center;
    box-shadow:0 8px 30px rgba(0,0,0,0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  .logo{
    font-size:2.5rem;
    font-weight:900;
    color:var(--accent);
    margin-bottom:10px;
  }
  .tagline{
    color:var(--muted);
    margin-bottom:30px;
  }
  .btn-google{
    display:flex;
    align-items:center;
    justify-content:center;
    background:white;
    color:#1f2937;
    padding:12px 20px;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
    transition:background-color 0.2s, box-shadow 0.2s;
    border: none;
    width: 100%;
  }
  .btn-google:hover{
    background:#f3f4f6;
    box-shadow:0 4px 15px rgba(88, 101, 242, 0.3);
  }
  .btn-google svg{
    margin-right:10px;
  }

  /* Custom Modal styles */
  .custom-modal{
    position:fixed;inset:0;
    display:none;align-items:center;justify-content:center;
    background:rgba(2,6,23,0.8);
    z-index:100;
    backdrop-filter: blur(5px);
  }
  .custom-modal .box{
    width:92%;max-width:400px;
    background:linear-gradient(180deg,#1e293b,#0f172a);
    border-radius:10px;
    padding:20px;
    box-shadow:0 12px 40px rgba(2,6,23,0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  .btn{
    padding:8px 12px;
    border-radius:8px;
    border:none;
    background:var(--accent);
    color:white;
    cursor:pointer;
    font-weight: 600;
    transition: background-color 0.2s, box-shadow 0.2s;
  }
  .btn.alt{
    background:transparent;
    border:1px solid rgba(255,255,255,0.1);
    color:#e6eef8;
    padding: 6px 10px;
    font-size: 13px;
  }
</style>
</head>
<body>

<div class="login-card">
  <div class="logo">ğŸ”¥</div>
  <h1 class="text-2xl font-bold mb-1">æ ¡åœ’èŠå¤©å®¤</h1>
  <p class="tagline">ä½¿ç”¨æ‚¨çš„ Google å¸³è™Ÿç™»å…¥ä¸¦é–‹å§‹èŠå¤©</p>

  <button id="loginBtn" class="btn-google">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.158,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.158,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.654,8.397,6.306,14.691z"/><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.979,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.62-3.344-11.246-7.903l-6.568,5.192C9.526,39.79,16.213,44,24,44z"/><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"/></svg>
    ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥
  </button>
  <p class="text-xs text-gray-500 mt-4">åƒ…æ”¯æ´ä½¿ç”¨ Gmail å¸³è™Ÿç™»å…¥</p>
</div>

<!-- Custom Modal for Alerts/Confirms -->
<div id="customModal" class="custom-modal">
  <div class="box">
    <h3 id="modalTitle" class="text-xl font-bold mb-3">è¨Šæ¯</h3>
    <div id="modalBody" class="text-sm text-gray-300 mb-4"></div>
    <div id="modalFooter" class="flex justify-end gap-2">
      <!-- Buttons injected here -->
    </div>
  </div>
</div>

<script type="module">
  // Modern Firebase V11 Modular Imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  
  /* ================= Global Variables & Configuration ================= */
  // å¿…é ˆä½¿ç”¨ç³»çµ±ç’°å¢ƒæä¾›çš„é…ç½®è®Šæ•¸
  const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

  // DOM Elements
  const loginBtn = document.getElementById('loginBtn');
  const customModal = document.getElementById('customModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalBody = document.getElementById('modalBody');
  const modalFooter = document.getElementById('modalFooter');

  /* ================= Custom Modal (replaces alert/confirm) ================= */

  /**
   * é¡¯ç¤ºè‡ªå®šç¾©æ¨¡æ…‹è¦–çª— (ç°¡åŒ–ç‰ˆï¼Œåªåšé€šçŸ¥)
   * @param {string} title æ¨™é¡Œ
   * @param {string} message è¨Šæ¯å…§å®¹
   */
  function showCustomModal(title, message) {
    modalTitle.textContent = title;
    modalBody.innerHTML = message;
    modalFooter.innerHTML = '';

    const closeBtn = document.createElement('button');
    closeBtn.className = 'btn';
    closeBtn.textContent = 'é—œé–‰';
    closeBtn.onclick = () => customModal.style.display = 'none';

    modalFooter.appendChild(closeBtn);
    customModal.style.display = 'flex';
  }

  // æª¢æŸ¥é…ç½®æ˜¯å¦å®Œæ•´
  if (!firebaseConfig || !firebaseConfig.apiKey) {
    // é€™è£¡ä½¿ç”¨ showCustomModal ä¾†é¿å…ä½¿ç”¨ alert()
    showCustomModal('è¨­å®šéŒ¯èª¤', 'Firebase é…ç½®éºå¤±æˆ–ç„¡æ•ˆï¼Œè«‹ç¢ºèª API é‡‘é‘°å·²è¨­å®šã€‚');
    loginBtn.disabled = true;
    loginBtn.textContent = "è¨­å®šéŒ¯èª¤ (è«‹è¦‹è¨Šæ¯)";
    console.error("Firebase configuration error: __firebase_config missing or invalid.");
    // ç‚ºäº†é˜²æ­¢ç¨‹å¼ç¢¼å´©æ½°ï¼Œé€™è£¡å¯ä»¥ throw error æˆ– return
  } else {
    /* ================= Firebase Initialization ================= */
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // ç™»å…¥æŒ‰éˆ•é»æ“Šäº‹ä»¶
    loginBtn.onclick = async () => {
      try {
        loginBtn.textContent = 'ç™»å…¥ä¸­...';
        loginBtn.disabled = true;

        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        
        // æˆåŠŸç™»å…¥ï¼Œå°å‘ chat.html
        if (user) {
          window.location.href = 'chat.html';
        }

      } catch (error) {
        console.error("Login Error:", error);
        
        let errorMessage = "ç™»å…¥éç¨‹ä¸­ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ã€‚";
        if (error.code === 'auth/popup-closed-by-user') {
          errorMessage = "ç™»å…¥è¦–çª—è¢«æ‚¨é—œé–‰ã€‚";
        } else if (error.code === 'auth/cancelled-popup-request') {
          errorMessage = "æ‚¨å·²ç™¼å‡ºå¦ä¸€å€‹ç™»å…¥è«‹æ±‚ï¼Œå‰ä¸€å€‹è¢«å–æ¶ˆã€‚";
        }
        
        showCustomModal('ç™»å…¥å¤±æ•—', errorMessage + '<br><br>è«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£ç·šæˆ–æˆæ¬Šç¶²åŸŸè¨­å®šã€‚');

      } finally {
        loginBtn.textContent = 'ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥';
        loginBtn.disabled = false;
      }
    };

    // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥ (å¦‚æœå·²ç™»å…¥ï¼Œç›´æ¥è·³è½‰)
    onAuthStateChanged(auth, (user) => {
      if (user) {
        window.location.href = 'chat.html';
      } else {
        loginBtn.disabled = false;
        loginBtn.textContent = 'ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥';
      }
    });
  }
</script>
</body>
</html>